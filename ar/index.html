<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Time Guardian - FINAL</title>
    
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
        
        #startScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; display: flex; align-items: center; justify-content: center;
            z-index: 1000; text-align: center; padding: 20px; box-sizing: border-box;
        }
        
        h1 { font-size: 2.5em; margin: 0 0 20px 0; }
        
        .instructions {
            background: rgba(255,255,255,0.2); padding: 25px; border-radius: 20px;
            margin: 20px 0; border: 2px solid rgba(255,255,255,0.3);
        }
        
        .step { margin: 12px 0; font-size: 1.1em; }
        
        .warning {
            background: rgba(255,0,0,0.3); padding: 15px; border-radius: 10px;
            margin-top: 15px; border: 2px solid red;
        }
        
        #startBtn {
            background: #00ff88; color: #1a1a2e; border: none; padding: 18px 50px;
            font-size: 1.3em; font-weight: bold; border-radius: 50px;
            cursor: pointer; margin-top: 25px;
        }
        
        #info {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.9); color: white; padding: 15px 25px;
            border-radius: 15px; z-index: 100; font-size: 16px; font-weight: 600;
        }
        
        #progress {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 20px; z-index: 100;
        }
        
        .dot {
            width: 50px; height: 50px; border-radius: 50%;
            background: rgba(255,255,255,0.3); border: 4px solid white;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 20px;
        }
        
        .dot.active { background: #FFC107; box-shadow: 0 0 25px #FFC107; }
        .dot.done { background: #4CAF50; box-shadow: 0 0 20px #4CAF50; }
        
        #endScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: none; align-items: center; justify-content: center;
            z-index: 2000; padding: 20px; box-sizing: border-box;
        }
        
        #endScreen.show { display: flex; }
        
        .end-content {
            background: rgba(0,0,0,0.95); padding: 40px; border-radius: 25px;
            text-align: center; max-width: 500px; color: white; border: 3px solid;
        }
        
        .end-content.good { border-color: #4CAF50; }
        .end-content.bad { border-color: #f44336; }
        
        .end-content h1 { font-size: 2.5em; margin: 0 0 20px 0; }
        .end-content.good h1 { color: #4CAF50; }
        .end-content.bad h1 { color: #f44336; }
        
        .end-content p { font-size: 1.2em; margin: 15px 0; }
        
        #replayBtn {
            background: #667eea; color: white; border: none; padding: 15px 40px;
            font-size: 1.2em; font-weight: bold; border-radius: 50px;
            cursor: pointer; margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Start Screen -->
    <div id="startScreen">
        <div>
            <h1>‚è≥ TIME GUARDIAN ‚è≥</h1>
            <div class="instructions">
                <h2>‚úÖ CORRECT ORDER:</h2>
                <div class="step">1Ô∏è‚É£ <strong>HIRO</strong> ‚Üí Ancient Portal</div>
                <div class="step">2Ô∏è‚É£ <strong>Barcode 2</strong> ‚Üí Industrial Portal</div>
                <div class="step">3Ô∏è‚É£ <strong>Barcode 1</strong> ‚Üí Future Portal = WIN</div>
                
                <div class="warning">
                    <strong>‚ö†Ô∏è WARNING!</strong><br>
                    <strong>Barcode 0</strong> = INSTANT FAIL!
                </div>
            </div>
            <button id="startBtn">START</button>
        </div>
    </div>

    <div id="info" style="display:none;">
        <div id="infoText">Point at HIRO</div>
    </div>
    
    <div id="progress" style="display:none;">
        <div class="dot" id="d1">1</div>
        <div class="dot" id="d2">2</div>
        <div class="dot" id="d3">3</div>
    </div>

    <div id="endScreen">
        <div id="endContent" class="end-content">
            <h1 id="endTitle"></h1>
            <p id="endMessage"></p>
            <button id="replayBtn">REPLAY</button>
        </div>
    </div>

    <!-- AR Scene -->
    <a-scene
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true"
        embedded
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">
        
        <!-- HIRO - Ancient Portal -->
        <a-marker preset="hiro" id="m1" emitevents="true">
            <!-- BIG GOLD BOX -->
            <a-box color="#FFD700" scale="1.5 1.5 1.5" position="0 1.5 0"
                   animation="property: rotation; to: 360 360 360; loop: true; dur: 4000; easing: linear">
            </a-box>
            
            <!-- BIG BROWN RING -->
            <a-torus color="#8B4513" radius="2" radius-tubular="0.3" position="0 1.5 0"
                     animation="property: rotation; to: 0 360 0; loop: true; dur: 5000; easing: linear">
            </a-torus>
            
            <!-- GLOWING CYLINDER -->
            <a-cylinder color="#CD853F" opacity="0.6" radius="1" height="3" position="0 1.5 0">
            </a-cylinder>
            
            <a-text value="ANCIENT" align="center" color="#FFD700" width="8" position="0 3.5 0"></a-text>
        </a-marker>

        <!-- Barcode 2 NFT - Industrial Portal -->
        <a-nft type="nft" url="barecode_2" id="m2" emitevents="true"
               smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
            <!-- SPINNING GEARS -->
            <a-torus color="#606060" radius="2" radius-tubular="0.4" position="0 150 0"
                     animation="property: rotation; to: 360 0 0; loop: true; dur: 4000; easing: linear">
            </a-torus>
            
            <a-box color="#A9A9A9" scale="1.5 1.5 1.5" position="0 150 0"
                   animation="property: rotation; to: 0 360 0; loop: true; dur: 5000; easing: linear">
            </a-box>
            
            <a-text value="INDUSTRIAL" align="center" color="#C0C0C0" width="8" position="0 180 0"></a-text>
        </a-nft>

        <!-- Barcode 1 NFT - Future Portal (WIN) -->
        <a-nft type="nft" url="barecode_1" id="m3" emitevents="true"
               smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
            <!-- GLOWING CYAN SPHERE -->
            <a-sphere color="#00FFFF" opacity="0.9" radius="1.5" position="0 150 0"
                      animation="property: scale; to: 2 2 2; loop: true; dur: 2000; dir: alternate">
            </a-sphere>
            
            <!-- ROTATING RINGS -->
            <a-ring color="#00CED1" radius-inner="1.8" radius-outer="2.5" position="0 150 0" rotation="90 0 0"
                    animation="property: rotation; to: 90 360 0; loop: true; dur: 3000; easing: linear">
            </a-ring>
            
            <a-text value="FUTURE" align="center" color="#00FFFF" width="8" position="0 180 0"></a-text>
        </a-nft>

        <!-- Barcode 0 NFT - Paradox (FAIL) -->
        <a-nft type="nft" url="barecode_0" id="m4" emitevents="true"
               smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
            <!-- RED CHAOS -->
            <a-sphere color="#FF0000" opacity="0.9" radius="1.5" position="0 150 0"
                      animation="property: rotation; to: 360 720 360; loop: true; dur: 1500; easing: linear">
            </a-sphere>
            
            <a-octahedron color="#8B008B" radius="1.2" position="0 150 0"
                          animation="property: rotation; to: 720 360 0; loop: true; dur: 1000; easing: linear">
            </a-octahedron>
            
            <a-text value="DANGER!" align="center" color="#FF0000" width="8" position="0 180 0"
                    animation="property: opacity; from: 1; to: 0.2; loop: true; dur: 300; dir: alternate">
            </a-text>
        </a-nft>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        console.log('üöÄ AR Time Guardian Started');
        
        const state = {
            active: false,
            seq: [],
            correct: ['hiro', 'b2', 'b1'],
            done: false
        };

        document.getElementById('startBtn').addEventListener('click', () => {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('info').style.display = 'block';
            document.getElementById('progress').style.display = 'flex';
            state.active = true;
            updateInfo('üîç Point at HIRO marker');
        });

        document.getElementById('replayBtn').addEventListener('click', () => location.reload());

        function updateInfo(text) {
            document.getElementById('infoText').textContent = text;
        }

        function updateDots() {
            ['d1','d2','d3'].forEach((id, i) => {
                const d = document.getElementById(id);
                d.className = 'dot';
                if (i < state.seq.length) d.classList.add('done');
                else if (i === state.seq.length) d.classList.add('active');
            });
        }

        function win() {
            if (state.done) return;
            state.done = true;
            const ec = document.getElementById('endContent');
            ec.className = 'end-content good';
            document.getElementById('endTitle').textContent = 'üåü YOU WIN! üåü';
            document.getElementById('endMessage').textContent = 'Timeline restored! All portals activated correctly!';
            document.getElementById('endScreen').classList.add('show');
        }

        function fail(msg) {
            if (state.done) return;
            state.done = true;
            const ec = document.getElementById('endContent');
            ec.className = 'end-content bad';
            document.getElementById('endTitle').textContent = 'üí• PARADOX! üí•';
            document.getElementById('endMessage').textContent = msg;
            document.getElementById('endScreen').classList.add('show');
        }

        // HIRO
        document.getElementById('m1').addEventListener('markerFound', () => {
            console.log('‚úÖ HIRO detected!');
            if (!state.active || state.done) return;
            
            if (state.seq.length === 0) {
                state.seq.push('hiro');
                updateDots();
                updateInfo('‚úÖ Ancient! Now find Barcode 2');
            } else if (!state.seq.includes('hiro')) {
                fail('Must scan HIRO first!');
            }
        });

        // Barcode 2
        document.getElementById('m2').addEventListener('markerFound', () => {
            console.log('‚úÖ Barcode 2 detected!');
            if (!state.active || state.done) return;
            
            if (state.seq.length === 1 && state.seq[0] === 'hiro') {
                state.seq.push('b2');
                updateDots();
                updateInfo('‚úÖ Industrial! Now find Barcode 1');
            } else if (state.seq.length === 0) {
                fail('Must scan HIRO first!');
            } else {
                fail('Wrong order!');
            }
        });

        // Barcode 1 (WIN)
        document.getElementById('m3').addEventListener('markerFound', () => {
            console.log('‚úÖ Barcode 1 detected!');
            if (!state.active || state.done) return;
            
            if (state.seq.length === 2 && state.seq[0] === 'hiro' && state.seq[1] === 'b2') {
                state.seq.push('b1');
                updateDots();
                updateInfo('üéâ Future portal!');
                setTimeout(win, 1000);
            } else {
                fail('Must complete HIRO ‚Üí Barcode 2 first!');
            }
        });

        // Barcode 0 (FAIL)
        document.getElementById('m4').addEventListener('markerFound', () => {
            console.log('‚ùå Barcode 0 detected - FAIL!');
            if (!state.active || state.done) return;
            fail('You scanned Barcode 0! This creates a paradox!');
        });
    </script>
</body>
</html>