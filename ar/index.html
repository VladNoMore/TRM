<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR Time Guardian - WORKING VERSION</title>
    
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
        
        #start {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            z-index: 200;
            max-width: 85%;
            box-shadow: 0 10px 50px rgba(0,0,0,0.5);
        }
        
        #start h1 { font-size: 32px; margin-bottom: 15px; }
        #start p { margin: 10px 0; font-size: 15px; line-height: 1.6; }
        #start button {
            margin-top: 30px;
            padding: 18px 50px;
            font-size: 20px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .warning {
            background: rgba(255,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border: 2px solid red;
        }
        
        #info {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            z-index: 100;
            font-size: 16px;
            max-width: 85%;
        }
        
        #progress {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
        }
        
        .dot {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            border: 3px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
        }
        
        .dot.active { 
            background: #FFC107; 
            box-shadow: 0 0 25px #FFC107;
            animation: pulse 1s infinite;
        }
        .dot.done { background: #4CAF50; }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        
        #endScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
            background: rgba(0,0,0,0.8);
        }
        
        #endScreen.show { display: flex; }
        
        .end-content {
            background: rgba(0,0,0,0.95);
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            max-width: 500px;
            color: white;
            border: 3px solid;
        }
        
        .end-content.good { border-color: #4CAF50; }
        .end-content.bad { border-color: #f44336; }
        
        .end-content h1 { font-size: 2.5em; margin: 0 0 20px 0; }
        .end-content.good h1 { color: #4CAF50; }
        .end-content.bad h1 { color: #f44336; }
        
        .end-content p { font-size: 1.2em; margin: 15px 0; }
        
        #replayBtn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Start Screen -->
    <div id="start">
        <h1>‚è≥ TIME GUARDIAN ‚è≥</h1>
        <p style="font-size: 18px;"><strong>Mission: Restore the Timeline</strong></p>
        <p style="font-size: 14px; margin-top: 15px;">
            <strong>‚úÖ CORRECT ORDER:</strong><br>
            1Ô∏è‚É£ HIRO ‚Üí Ancient Portal<br>
            2Ô∏è‚É£ Barcode 2 ‚Üí Industrial Portal<br>
            3Ô∏è‚É£ Barcode 1 ‚Üí Future Portal = WIN
        </p>
        <div class="warning">
            <strong>‚ö†Ô∏è WARNING!</strong><br>
            Scanning <strong>Barcode 0</strong> = INSTANT FAIL!
        </div>
        <button onclick="start()">START MISSION</button>
    </div>

    <div id="info" style="display:none;">Point at HIRO marker</div>
    
    <div id="progress" style="display:none;">
        <div class="dot" id="d1">1</div>
        <div class="dot" id="d2">2</div>
        <div class="dot" id="d3">3</div>
    </div>
    
    <!-- End Screen -->
    <div id="endScreen">
        <div id="endContent" class="end-content">
            <h1 id="endTitle"></h1>
            <p id="endMessage"></p>
            <button id="replayBtn" onclick="location.reload()">REPLAY</button>
        </div>
    </div>

    <a-scene
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; precision: mediump; alpha: true"
        embedded
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
        
        <!-- HIRO - Ancient Portal -->
        <a-marker preset="hiro" id="m1" emitevents="true" smooth="true" smoothCount="10">
            <!-- BIG GOLD BOX -->
            <a-box 
                color="#FFD700" 
                metalness="0.9"
                roughness="0.1"
                width="1" height="1" depth="1"
                position="0 0.5 0"
                animation="property: rotation; to: 360 360 360; loop: true; dur: 4000; easing: linear">
            </a-box>
            
            <!-- BIG BROWN RING -->
            <a-torus 
                color="#8B4513" 
                radius="1.4" 
                radius-tubular="0.2" 
                position="0 0.5 0"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 5000; easing: linear">
            </a-torus>
            
            <!-- GLOWING CYLINDER -->
            <a-cylinder 
                color="#CD853F" 
                opacity="0.6" 
                radius="0.8" 
                height="2" 
                position="0 0.5 0"
                animation="property: scale; to: 1 1.2 1; loop: true; dur: 2000; dir: alternate">
            </a-cylinder>
            
            <a-text 
                value="ANCIENT" 
                align="center" 
                color="#FFD700" 
                width="4" 
                position="0 2 0">
            </a-text>
        </a-marker>

        <!-- Barcode 2 - Industrial Portal -->
        <a-marker type="barcode" value="2" id="m2" emitevents="true" smooth="true" smoothCount="10">
            <!-- SPINNING GEARS -->
            <a-torus 
                color="#606060" 
                radius="1.3" 
                radius-tubular="0.25" 
                position="0 0.5 0"
                animation="property: rotation; to: 360 0 0; loop: true; dur: 4000; easing: linear">
            </a-torus>
            
            <a-box 
                color="#A9A9A9" 
                metalness="0.8"
                roughness="0.3"
                scale="0.9 0.9 0.9" 
                position="0 0.5 0"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 5000; easing: linear">
            </a-box>
            
            <a-sphere 
                radius="1.5" 
                color="#808080" 
                opacity="0.2"
                position="0 0.5 0"
                animation="property: scale; to: 1.2 1.2 1.2; loop: true; dur: 2000; dir: alternate">
            </a-sphere>
            
            <a-text 
                value="INDUSTRIAL" 
                align="center" 
                color="#C0C0C0" 
                width="4" 
                position="0 2 0">
            </a-text>
        </a-marker>

        <!-- Barcode 1 - Future Portal (WIN) -->
        <a-marker type="barcode" value="1" id="m3" emitevents="true" smooth="true" smoothCount="10">
            <!-- GLOWING CYAN SPHERE -->
            <a-sphere 
                color="#00FFFF" 
                opacity="0.9" 
                radius="1" 
                position="0 0.5 0"
                animation="property: scale; to: 1.4 1.4 1.4; loop: true; dur: 2000; dir: alternate; easing: easeInOutQuad">
            </a-sphere>
            
            <!-- ROTATING RINGS -->
            <a-ring 
                color="#00CED1" 
                radius-inner="1.2" 
                radius-outer="1.5" 
                position="0 0.5 0" 
                rotation="90 0 0"
                animation="property: rotation; to: 90 360 0; loop: true; dur: 3000; easing: linear">
            </a-ring>
            
            <a-ring 
                color="#40E0D0" 
                radius-inner="0.8" 
                radius-outer="1.1" 
                position="0 0.5 0" 
                rotation="-90 0 0"
                animation="property: rotation; to: -90 -360 0; loop: true; dur: 4000; easing: linear">
            </a-ring>
            
            <a-text 
                value="FUTURE" 
                align="center" 
                color="#00FFFF" 
                width="4" 
                position="0 2 0">
            </a-text>
        </a-marker>

        <!-- Barcode 0 - Paradox (FAIL) -->
        <a-marker type="barcode" value="0" id="m4" emitevents="true" smooth="true" smoothCount="10">
            <!-- RED CHAOS -->
            <a-sphere 
                color="#FF0000" 
                opacity="0.9" 
                radius="1" 
                position="0 0.5 0"
                animation="property: rotation; to: 360 720 360; loop: true; dur: 1500; easing: linear">
            </a-sphere>
            
            <a-octahedron 
                color="#8B008B" 
                radius="0.8" 
                position="0 0.5 0"
                animation="property: rotation; to: 720 360 0; loop: true; dur: 1000; easing: linear">
            </a-octahedron>
            
            <a-ring 
                color="#FF0000" 
                radius-inner="1.2" 
                radius-outer="1.5" 
                position="0 0.5 0"
                rotation="0 0 0"
                animation="property: rotation; to: 0 360 360; loop: true; dur: 2000; easing: linear">
            </a-ring>
            
            <a-text 
                value="DANGER!" 
                align="center" 
                color="#FF0000" 
                width="4" 
                position="0 2 0"
                animation="property: opacity; from: 1; to: 0.2; loop: true; dur: 300; dir: alternate">
            </a-text>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        console.log('üöÄ AR Time Guardian Started');
        
        const state = {
            active: false,
            seq: [],
            done: false
        };

        function start() {
            document.getElementById('start').style.display = 'none';
            document.getElementById('info').style.display = 'block';
            document.getElementById('progress').style.display = 'flex';
            state.active = true;
            updateInfo('üîç Point at HIRO marker');
            updateDot(1, 'active');
        }

        function updateInfo(text) {
            document.getElementById('info').textContent = text;
        }

        function updateDot(n, s) {
            const dot = document.getElementById('d' + n);
            dot.className = 'dot';
            dot.textContent = n;
            if (s === 'active') dot.classList.add('active');
            if (s === 'done') dot.classList.add('done');
        }

        function win() {
            if (state.done) return;
            state.done = true;
            const ec = document.getElementById('endContent');
            ec.className = 'end-content good';
            document.getElementById('endTitle').textContent = 'üåü YOU WIN! üåü';
            document.getElementById('endMessage').textContent = 'Timeline restored! All portals activated in correct order!';
            document.getElementById('endScreen').classList.add('show');
        }

        function fail(msg) {
            if (state.done) return;
            state.done = true;
            const ec = document.getElementById('endContent');
            ec.className = 'end-content bad';
            document.getElementById('endTitle').textContent = 'üí• TIME PARADOX! üí•';
            document.getElementById('endMessage').textContent = msg;
            document.getElementById('endScreen').classList.add('show');
        }

        // HIRO
        document.getElementById('m1').addEventListener('markerFound', () => {
            console.log('‚úÖ HIRO detected!');
            if (!state.active || state.done) return;
            
            if (state.seq.length === 0) {
                state.seq.push('hiro');
                updateDot(1, 'done');
                updateDot(2, 'active');
                updateInfo('‚úÖ Ancient Portal! Now scan Barcode 2');
            } else if (!state.seq.includes('hiro')) {
                fail('You must scan HIRO first!');
            }
        });

        // Barcode 2
        document.getElementById('m2').addEventListener('markerFound', () => {
            console.log('‚úÖ Barcode 2 detected!');
            if (!state.active || state.done) return;
            
            if (state.seq.length === 1 && state.seq[0] === 'hiro') {
                state.seq.push('b2');
                updateDot(2, 'done');
                updateDot(3, 'active');
                updateInfo('‚úÖ Industrial Portal! Now scan Barcode 1');
            } else if (state.seq.length === 0) {
                fail('You must scan HIRO first!');
            } else {
                fail('Wrong order! Must be: HIRO ‚Üí Barcode 2 ‚Üí Barcode 1');
            }
        });

        // Barcode 1 (WIN)
        document.getElementById('m3').addEventListener('markerFound', () => {
            console.log('‚úÖ Barcode 1 detected!');
            if (!state.active || state.done) return;
            
            if (state.seq.length === 2 && state.seq[0] === 'hiro' && state.seq[1] === 'b2') {
                state.seq.push('b1');
                updateDot(3, 'done');
                updateInfo('üéâ Future Portal activated!');
                setTimeout(win, 1000);
            } else {
                fail('Must complete HIRO ‚Üí Barcode 2 first!');
            }
        });

        // Barcode 0 (FAIL)
        document.getElementById('m4').addEventListener('markerFound', () => {
            console.log('‚ùå Barcode 0 detected - PARADOX!');
            if (!state.active || state.done) return;
            fail('You scanned Barcode 0! This created a time paradox!');
        });
    </script>
</body>
</html>