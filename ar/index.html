<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AR Time Guardian</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.4/aframe/build/aframe-ar-nft.js"></script>

    <style>
        body, html {
            margin: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
            font-family: sans-serif;
        }
        
        #startScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            text-align: center;
            padding: 20px;
        }
        
        #startScreen h1 { font-size: 40px; margin-bottom: 20px; }
        #startScreen p { font-size: 16px; margin: 10px 0; line-height: 1.6; }
        
        .warning {
            background: rgba(255,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid red;
        }
        
        #startScreen button {
            margin-top: 30px;
            padding: 20px 60px;
            font-size: 24px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
        }
        
        #statusBox {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.85);
            color: #fff;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 18px;
            z-index: 5;
            max-width: 90vw;
            display: none;
        }
        
        #progress {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            gap: 20px;
            z-index: 5;
        }
        
        .dot {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            border: 4px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            color: white;
        }
        
        .dot.active {
            background: #FFC107;
            box-shadow: 0 0 30px #FFC107;
            animation: pulse 1s infinite;
        }
        
        .dot.done { background: #4CAF50; }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        
        #tapHint {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: black;
            padding: 20px 40px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 22px;
            display: none;
            z-index: 5;
            animation: bounce 0.7s infinite;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }
        
        #choiceButtons {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            gap: 20px;
            z-index: 5;
        }
        
        .choice-btn {
            padding: 25px 40px;
            font-size: 20px;
            font-weight: bold;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }
        
        #goodBtn {
            background: #4CAF50;
            color: white;
        }
        
        #badBtn {
            background: #f44336;
            color: white;
        }
        
        #endScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
        }
        
        #endScreen.show { display: flex; }
        
        .end-content {
            background: rgba(0,0,0,0.95);
            padding: 50px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            color: white;
            border: 4px solid;
        }
        
        .end-content.good { border-color: #4CAF50; }
        .end-content.bad { border-color: #f44336; }
        
        .end-content h1 { font-size: 3em; margin: 0 0 20px 0; }
        .end-content.good h1 { color: #4CAF50; }
        .end-content.bad h1 { color: #f44336; }
        
        .end-content p { font-size: 1.3em; margin: 20px 0; line-height: 1.6; }
        
        #replayBtn {
            background: #667eea;
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.3em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 25px;
        }
    </style>
</head>
<body>
    <!-- Start Screen -->
    <div id="startScreen">
        <div style="max-width: 600px;">
            <h1>‚è≥ TIME GUARDIAN ‚è≥</h1>
            <p style="font-size: 20px;"><strong>Mission: Restore the Timeline</strong></p>
            <p style="font-size: 16px;">
                Scan the <b>HIRO marker</b> and activate portals by tapping:<br><br>
                <strong>Portal 1:</strong> Ancient ‚Üí TAP SCREEN<br>
                <strong>Portal 2:</strong> Industrial ‚Üí TAP SCREEN<br>
                <strong>Portal 3:</strong> Future ‚Üí CHOOSE YOUR ENDING
            </p>
            <div class="warning">
                <strong>‚ö†Ô∏è TWO ENDINGS!</strong><br>
                At Portal 3, choose:<br>
                ‚úÖ <strong>GREEN</strong> = Good Ending (Timeline Saved)<br>
                ‚ùå <strong>RED</strong> = Bad Ending (Paradox)
            </div>
            <button onclick="start()">START MISSION</button>
        </div>
    </div>

    <div id="statusBox">Point at HIRO marker</div>
    
    <div id="progress">
        <div class="dot" id="d1">1</div>
        <div class="dot" id="d2">2</div>
        <div class="dot" id="d3">3</div>
    </div>
    
    <div id="tapHint">üëÜ TAP SCREEN!</div>
    
    <div id="choiceButtons">
        <button id="goodBtn" class="choice-btn" onclick="choose('good')">‚úÖ SAVE<br>TIMELINE</button>
        <button id="badBtn" class="choice-btn" onclick="choose('bad')">‚ùå CREATE<br>PARADOX</button>
    </div>
    
    <!-- End Screen -->
    <div id="endScreen">
        <div id="endContent" class="end-content">
            <h1 id="endTitle"></h1>
            <p id="endMessage"></p>
            <button id="replayBtn" onclick="location.reload()">REPLAY MISSION</button>
        </div>
    </div>

    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        renderer="logarithmicDepthBuffer: true;"
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">
        
        <!-- Lights -->
        <a-entity light="type: ambient; intensity: 0.9"></a-entity>
        <a-entity light="type: directional; intensity: 0.8" position="0 1 1"></a-entity>

        <!-- HIRO marker with all 3 portals -->
        <a-marker id="marker-hiro" preset="hiro" emitevents="true">
            
            <!-- Portal 1: Ancient (shown first) -->
            <a-entity id="portal1" visible="true">
                <a-box 
                    color="#FFD700" 
                    scale="1 1 1"
                    position="0 0.5 0"
                    animation="property: rotation; to: 360 360 360; loop: true; dur: 4000">
                </a-box>
                
                <a-torus 
                    color="#8B4513" 
                    radius="1.4" 
                    radius-tubular="0.2"
                    position="0 0.5 0"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 5000">
                </a-torus>
                
                <a-cylinder 
                    color="#CD853F" 
                    opacity="0.6" 
                    radius="0.8" 
                    height="2"
                    position="0 0.5 0">
                </a-cylinder>
                
                <a-text 
                    value="ANCIENT\nPORTAL 1" 
                    align="center" 
                    color="#FFD700" 
                    width="4" 
                    position="0 2.2 0">
                </a-text>
            </a-entity>
            
            <!-- Portal 2: Industrial (shown after portal 1) -->
            <a-entity id="portal2" visible="false">
                <a-box 
                    color="#606060" 
                    scale="0.9 0.9 0.9"
                    position="0 0.5 0"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 4000">
                </a-box>
                
                <a-torus 
                    color="#A9A9A9" 
                    radius="1.3" 
                    radius-tubular="0.2"
                    position="0 0.5 0"
                    animation="property: rotation; to: 360 0 0; loop: true; dur: 5000">
                </a-torus>
                
                <a-ring 
                    color="#808080" 
                    radius-inner="1.5" 
                    radius-outer="1.8"
                    position="0 0.5 0"
                    rotation="90 0 0"
                    animation="property: rotation; to: 90 360 0; loop: true; dur: 6000">
                </a-ring>
                
                <a-text 
                    value="INDUSTRIAL\nPORTAL 2" 
                    align="center" 
                    color="#C0C0C0" 
                    width="4" 
                    position="0 2.2 0">
                </a-text>
            </a-entity>
            
            <!-- Portal 3: Future (shown after portal 2) -->
            <a-entity id="portal3" visible="false">
                <a-sphere 
                    color="#00FFFF" 
                    opacity="0.9" 
                    radius="1"
                    position="0 0.5 0"
                    animation="property: scale; to: 1.4 1.4 1.4; loop: true; dur: 2000; dir: alternate">
                </a-sphere>
                
                <a-ring 
                    color="#00CED1" 
                    radius-inner="1.2" 
                    radius-outer="1.5"
                    position="0 0.5 0"
                    rotation="90 0 0"
                    animation="property: rotation; to: 90 360 0; loop: true; dur: 3000">
                </a-ring>
                
                <a-ring 
                    color="#40E0D0" 
                    radius-inner="0.8" 
                    radius-outer="1.1"
                    position="0 0.5 0"
                    rotation="-90 0 0"
                    animation="property: rotation; to: -90 -360 0; loop: true; dur: 4000">
                </a-ring>
                
                <a-text 
                    value="FUTURE\nPORTAL 3" 
                    align="center" 
                    color="#00FFFF" 
                    width="4" 
                    position="0 2.2 0">
                </a-text>
            </a-entity>
            
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        console.log('üöÄ AR Time Guardian - HIRO Only Version');
        
        const statusBox = document.getElementById('statusBox');
        const markerHiro = document.getElementById('marker-hiro');
        
        const portal1 = document.getElementById('portal1');
        const portal2 = document.getElementById('portal2');
        const portal3 = document.getElementById('portal3');
        
        let p1Done = false;
        let p2Done = false;
        let p3Done = false;
        let markerVisible = false;
        let gameEnded = false;
        
        function start() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('statusBox').style.display = 'block';
            document.getElementById('progress').style.display = 'flex';
            document.getElementById('d1').classList.add('active');
        }
        
        function updateUI() {
            if (!p1Done) {
                portal1.setAttribute('visible', 'true');
                portal2.setAttribute('visible', 'false');
                portal3.setAttribute('visible', 'false');
                statusBox.innerHTML = 'Portal 1: <b>ANCIENT</b> - Scan HIRO & TAP!';
                if (markerVisible) {
                    document.getElementById('tapHint').style.display = 'block';
                    document.getElementById('choiceButtons').style.display = 'none';
                }
            } else if (!p2Done) {
                portal1.setAttribute('visible', 'false');
                portal2.setAttribute('visible', 'true');
                portal3.setAttribute('visible', 'false');
                statusBox.innerHTML = 'Portal 2: <b>INDUSTRIAL</b> - Scan HIRO & TAP!';
                if (markerVisible) {
                    document.getElementById('tapHint').style.display = 'block';
                    document.getElementById('choiceButtons').style.display = 'none';
                }
            } else if (!p3Done) {
                portal1.setAttribute('visible', 'false');
                portal2.setAttribute('visible', 'false');
                portal3.setAttribute('visible', 'true');
                statusBox.innerHTML = 'Portal 3: <b>FUTURE</b> - CHOOSE YOUR ENDING!';
                if (markerVisible) {
                    document.getElementById('tapHint').style.display = 'none';
                    document.getElementById('choiceButtons').style.display = 'flex';
                }
            }
        }
        
        function choose(type) {
            if (!markerVisible || gameEnded) return;
            
            p3Done = true;
            gameEnded = true;
            document.getElementById('d3').classList.remove('active');
            document.getElementById('d3').classList.add('done');
            document.getElementById('choiceButtons').style.display = 'none';
            
            const ec = document.getElementById('endContent');
            
            if (type === 'good') {
                ec.className = 'end-content good';
                document.getElementById('endTitle').textContent = 'üåü TIMELINE SAVED! üåü';
                document.getElementById('endMessage').textContent = 'You successfully traveled through all 3 time portals and restored the timeline! The universe is safe!';
            } else {
                ec.className = 'end-content bad';
                document.getElementById('endTitle').textContent = 'üí• TIME PARADOX! üí•';
                document.getElementById('endMessage').textContent = 'You created a time paradox! The timeline is destroyed and reality collapses!';
            }
            
            setTimeout(() => {
                document.getElementById('endScreen').classList.add('show');
            }, 1000);
        }
        
        // Tap to activate portals 1 and 2
        document.addEventListener('click', (e) => {
            // Ignore if clicking choice buttons
            if (e.target.id === 'goodBtn' || e.target.id === 'badBtn') return;
            
            if (!markerVisible || gameEnded) return;
            
            if (!p1Done) {
                p1Done = true;
                document.getElementById('d1').classList.remove('active');
                document.getElementById('d1').classList.add('done');
                document.getElementById('d2').classList.add('active');
                document.getElementById('tapHint').style.display = 'none';
                statusBox.innerHTML = '‚úÖ Portal 1 activated! Point at HIRO again';
                console.log('‚úÖ Portal 1 (Ancient) activated!');
            }
            else if (!p2Done) {
                p2Done = true;
                document.getElementById('d2').classList.remove('active');
                document.getElementById('d2').classList.add('done');
                document.getElementById('d3').classList.add('active');
                document.getElementById('tapHint').style.display = 'none';
                statusBox.innerHTML = '‚úÖ Portal 2 activated! Point at HIRO again';
                console.log('‚úÖ Portal 2 (Industrial) activated!');
            }
        });
        
        // HIRO marker events
        markerHiro.addEventListener('markerFound', () => {
            console.log('‚úÖ HIRO marker found!');
            markerVisible = true;
            updateUI();
        });
        
        markerHiro.addEventListener('markerLost', () => {
            console.log('Marker lost');
            markerVisible = false;
            document.getElementById('tapHint').style.display = 'none';
            document.getElementById('choiceButtons').style.display = 'none';
            
            if (!p1Done) {
                statusBox.innerHTML = 'Point at HIRO marker';
            } else if (!p2Done) {
                statusBox.innerHTML = 'Point at HIRO marker again';
            } else if (!p3Done) {
                statusBox.innerHTML = 'Point at HIRO marker again';
            }
        });
    </script>
</body>
</html>