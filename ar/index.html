<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AR Time Guardian - 3 Markers</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.4/aframe/build/aframe-ar-nft.js"></script>

    <style>
        body, html {
            margin: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
            font-family: sans-serif;
        }
        
        #startScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            text-align: center;
            padding: 20px;
        }
        
        #startScreen h1 { font-size: 40px; margin-bottom: 20px; }
        #startScreen p { font-size: 16px; margin: 10px 0; line-height: 1.6; }
        
        .marker-list {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .warning {
            background: rgba(255,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid red;
        }
        
        #startScreen button {
            margin-top: 30px;
            padding: 20px 60px;
            font-size: 24px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
        }
        
        #statusBox {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.85);
            color: #fff;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 18px;
            z-index: 5;
            max-width: 90vw;
            display: none;
        }
        
        #progress {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            gap: 20px;
            z-index: 5;
        }
        
        .dot {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            border: 4px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            color: white;
        }
        
        .dot.active {
            background: #FFC107;
            box-shadow: 0 0 30px #FFC107;
            animation: pulse 1s infinite;
        }
        
        .dot.done { background: #4CAF50; }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        
        #choiceButtons {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            gap: 20px;
            z-index: 5;
        }
        
        .choice-btn {
            padding: 25px 40px;
            font-size: 20px;
            font-weight: bold;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }
        
        #goodBtn {
            background: #4CAF50;
            color: white;
        }
        
        #badBtn {
            background: #f44336;
            color: white;
        }
        
        #endScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
        }
        
        #endScreen.show { display: flex; }
        
        .end-content {
            background: rgba(0,0,0,0.95);
            padding: 50px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            color: white;
            border: 4px solid;
        }
        
        .end-content.good { border-color: #4CAF50; }
        .end-content.bad { border-color: #f44336; }
        
        .end-content h1 { font-size: 3em; margin: 0 0 20px 0; }
        .end-content.good h1 { color: #4CAF50; }
        .end-content.bad h1 { color: #f44336; }
        
        .end-content p { font-size: 1.3em; margin: 20px 0; line-height: 1.6; }
        
        .journey {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: left;
        }
        
        .journey-step {
            margin: 10px 0;
            font-size: 1.1em;
        }
        
        #replayBtn {
            background: #667eea;
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.3em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 25px;
        }
    </style>
</head>
<body>
    <!-- Start Screen -->
    <div id="startScreen">
        <div style="max-width: 600px;">
            <h1>‚è≥ TIME GUARDIAN ‚è≥</h1>
            <p style="font-size: 20px;"><strong>Mission: Restore the Timeline</strong></p>
            
            <div class="marker-list">
                <strong>SCAN IN ORDER:</strong><br><br>
                1Ô∏è‚É£ <strong>HIRO</strong> ‚Üí Ancient Portal<br>
                2Ô∏è‚É£ <strong>KANJI</strong> (‰∫∫) ‚Üí Industrial Portal<br>
                3Ô∏è‚É£ <strong>CUSTOM</strong> ‚Üí Future Portal
            </div>
            
            <div class="warning">
                <strong>‚ö†Ô∏è TWO ENDINGS!</strong><br>
                At Portal 3, choose:<br>
                ‚úÖ <strong>GREEN</strong> = Timeline Saved (Good Ending)<br>
                ‚ùå <strong>RED</strong> = Time Paradox (Bad Ending)
            </div>
            
            <button onclick="start()">START MISSION</button>
        </div>
    </div>

    <div id="statusBox">Scan <b>HIRO</b> marker first</div>
    
    <div id="progress">
        <div class="dot" id="d1">1</div>
        <div class="dot" id="d2">2</div>
        <div class="dot" id="d3">3</div>
    </div>
    
    <div id="choiceButtons">
        <button id="goodBtn" class="choice-btn" onclick="choose('good')">‚úÖ SAVE<br>TIMELINE</button>
        <button id="badBtn" class="choice-btn" onclick="choose('bad')">‚ùå CREATE<br>PARADOX</button>
    </div>
    
    <!-- End Screen -->
    <div id="endScreen">
        <div id="endContent" class="end-content">
            <h1 id="endTitle"></h1>
            <p id="endMessage"></p>
            <div id="journeyLog" class="journey"></div>
            <button id="replayBtn" onclick="location.reload()">REPLAY MISSION</button>
        </div>
    </div>

    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        renderer="logarithmicDepthBuffer: true;"
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">
        
        <!-- Lights -->
        <a-entity light="type: ambient; intensity: 0.9"></a-entity>
        <a-entity light="type: directional; intensity: 0.8" position="0 1 1"></a-entity>

        <!-- HIRO marker -> Portal 1: Ancient (FIRST) -->
        <a-marker id="marker-hiro" preset="hiro" emitevents="true">
            <a-entity id="portal-hiro" visible="false">
                <a-box 
                    color="#FFD700" 
                    scale="1 1 1"
                    position="0 0.5 0"
                    animation="property: rotation; to: 360 360 360; loop: true; dur: 4000">
                </a-box>
                
                <a-torus 
                    color="#8B4513" 
                    radius="1.4" 
                    radius-tubular="0.2"
                    position="0 0.5 0"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 5000">
                </a-torus>
                
                <a-cylinder 
                    color="#CD853F" 
                    opacity="0.6" 
                    radius="0.8" 
                    height="2"
                    position="0 0.5 0">
                </a-cylinder>
                
                <a-text 
                    value="ANCIENT" 
                    align="center" 
                    color="#FFD700" 
                    width="4" 
                    position="0 2.2 0">
                </a-text>
            </a-entity>
        </a-marker>

        <!-- KANJI marker -> Portal 2: Industrial (SECOND) -->
        <a-marker id="marker-kanji" preset="kanji" emitevents="true">
            <a-entity id="portal-kanji" visible="false">
                <a-box 
                    color="#606060" 
                    scale="0.9 0.9 0.9"
                    position="0 0.5 0"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 4000">
                </a-box>
                
                <a-torus 
                    color="#A9A9A9" 
                    radius="1.3" 
                    radius-tubular="0.2"
                    position="0 0.5 0"
                    animation="property: rotation; to: 360 0 0; loop: true; dur: 5000">
                </a-torus>
                
                <a-ring 
                    color="#808080" 
                    radius-inner="1.5" 
                    radius-outer="1.8"
                    position="0 0.5 0"
                    rotation="90 0 0"
                    animation="property: rotation; to: 90 360 0; loop: true; dur: 6000">
                </a-ring>
                
                <a-text 
                    value="INDUSTRIAL" 
                    align="center" 
                    color="#C0C0C0" 
                    width="4" 
                    position="0 2.2 0">
                </a-text>
            </a-entity>
        </a-marker>

        <!-- CUSTOM marker -> Portal 3: Future (THIRD - with choice) -->
        <a-marker id="marker-custom" type="pattern" url="custom.patt" emitevents="true">
            <a-entity id="portal-custom" visible="false">
                <a-sphere 
                    color="#00FFFF" 
                    opacity="0.9" 
                    radius="1"
                    position="0 0.5 0"
                    animation="property: scale; to: 1.4 1.4 1.4; loop: true; dur: 2000; dir: alternate">
                </a-sphere>
                
                <a-ring 
                    color="#00CED1" 
                    radius-inner="1.2" 
                    radius-outer="1.5"
                    position="0 0.5 0"
                    rotation="90 0 0"
                    animation="property: rotation; to: 90 360 0; loop: true; dur: 3000">
                </a-ring>
                
                <a-ring 
                    color="#40E0D0" 
                    radius-inner="0.8" 
                    radius-outer="1.1"
                    position="0 0.5 0"
                    rotation="-90 0 0"
                    animation="property: rotation; to: -90 -360 0; loop: true; dur: 4000">
                </a-ring>
                
                <a-text 
                    value="FUTURE" 
                    align="center" 
                    color="#00FFFF" 
                    width="4" 
                    position="0 2.2 0">
                </a-text>
            </a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        console.log('üöÄ AR Time Guardian - 3 Pattern Markers Version');
        
        const statusBox = document.getElementById('statusBox');
        
        const markerHiro = document.getElementById('marker-hiro');
        const markerKanji = document.getElementById('marker-kanji');
        const markerCustom = document.getElementById('marker-custom');
        
        const portalHiro = document.getElementById('portal-hiro');
        const portalKanji = document.getElementById('portal-kanji');
        const portalCustom = document.getElementById('portal-custom');
        
        let hiroScanned = false;
        let kanjiScanned = false;
        let customScanned = false;
        let gameEnded = false;
        
        const sequence = [];
        
        function start() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('statusBox').style.display = 'block';
            document.getElementById('progress').style.display = 'flex';
            document.getElementById('d1').classList.add('active');
        }
        
        function updateDot(n, state) {
            const dot = document.getElementById('d' + n);
            dot.className = 'dot';
            if (state === 'active') dot.classList.add('active');
            if (state === 'done') dot.classList.add('done');
        }
        
        function showEnd(type) {
            if (gameEnded) return;
            gameEnded = true;
            
            const ec = document.getElementById('endContent');
            const journeyLog = document.getElementById('journeyLog');
            
            let journeyHTML = '<h3>Your Journey:</h3>';
            const portalNames = {
                'hiro': '‚úÖ HIRO ‚Üí Ancient Portal',
                'kanji': '‚úÖ KANJI ‚Üí Industrial Portal',
                'custom': '‚úÖ CUSTOM ‚Üí Future Portal'
            };
            
            sequence.forEach(step => {
                journeyHTML += `<div class="journey-step">${portalNames[step]}</div>`;
            });
            
            if (type === 'good') {
                ec.className = 'end-content good';
                document.getElementById('endTitle').textContent = 'üåü TIMELINE SAVED! üåü';
                document.getElementById('endMessage').textContent = 'You successfully traveled through all 3 time portals in the correct order and restored the timeline! The universe is safe!';
                journeyHTML += '<p style="margin-top: 20px; color: #4CAF50; font-weight: bold;">Mission Success! Grade: 10/10 üèÜ</p>';
            } else {
                ec.className = 'end-content bad';
                document.getElementById('endTitle').textContent = 'üí• TIME PARADOX! üí•';
                document.getElementById('endMessage').textContent = 'You created a time paradox by choosing the wrong path! The timeline is destroyed and reality collapses into chaos!';
                journeyHTML += '<p style="margin-top: 20px; color: #f44336;">Timeline Corrupted!</p>';
            }
            
            journeyLog.innerHTML = journeyHTML;
            
            setTimeout(() => {
                document.getElementById('endScreen').classList.add('show');
            }, 1000);
        }
        
        function choose(type) {
            if (gameEnded) return;
            document.getElementById('choiceButtons').style.display = 'none';
            showEnd(type);
        }
        
        // ---------- HIRO marker (first) ----------
        markerHiro.addEventListener('markerFound', () => {
            console.log('‚úÖ HIRO detected!');
            
            if (!hiroScanned) {
                portalHiro.setAttribute('visible', 'true');
                hiroScanned = true;
                sequence.push('hiro');
                updateDot(1, 'done');
                updateDot(2, 'active');
                statusBox.innerHTML = '‚úÖ Ancient Portal! Now scan <b>KANJI</b> marker (‰∫∫)';
            } else {
                portalHiro.setAttribute('visible', 'true');
            }
        });
        
        markerHiro.addEventListener('markerLost', () => {
            portalHiro.setAttribute('visible', 'false');
        });
        
        // ---------- KANJI marker (second) ----------
        markerKanji.addEventListener('markerFound', () => {
            console.log('‚úÖ KANJI detected!');
            
            if (!hiroScanned) {
                portalKanji.setAttribute('visible', 'false');
                statusBox.innerHTML = '‚ö†Ô∏è Scan <b>HIRO</b> marker first!';
                return;
            }
            
            portalKanji.setAttribute('visible', 'true');
            
            if (!kanjiScanned) {
                kanjiScanned = true;
                sequence.push('kanji');
                updateDot(2, 'done');
                updateDot(3, 'active');
                statusBox.innerHTML = '‚úÖ Industrial Portal! Now scan <b>CUSTOM</b> marker';
            }
        });
        
        markerKanji.addEventListener('markerLost', () => {
            portalKanji.setAttribute('visible', 'false');
        });
        
        // ---------- CUSTOM marker (third - with choice) ----------
        markerCustom.addEventListener('markerFound', () => {
            console.log('‚úÖ CUSTOM marker detected!');
            
            if (!hiroScanned) {
                portalCustom.setAttribute('visible', 'false');
                statusBox.innerHTML = '‚ö†Ô∏è Scan <b>HIRO</b> marker first!';
                return;
            }
            
            if (!kanjiScanned) {
                portalCustom.setAttribute('visible', 'false');
                statusBox.innerHTML = '‚ö†Ô∏è After HIRO, scan <b>KANJI</b> marker, then CUSTOM';
                return;
            }
            
            portalCustom.setAttribute('visible', 'true');
            
            if (!customScanned && !gameEnded) {
                customScanned = true;
                sequence.push('custom');
                updateDot(3, 'done');
                statusBox.innerHTML = 'üéâ Future Portal! <b>CHOOSE YOUR DESTINY!</b>';
                document.getElementById('choiceButtons').style.display = 'flex';
            }
        });
        
        markerCustom.addEventListener('markerLost', () => {
            portalCustom.setAttribute('visible', 'false');
        });
    </script>
</body>
</html>